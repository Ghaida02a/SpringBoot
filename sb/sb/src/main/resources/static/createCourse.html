<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Course</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        nav a { margin-right: 10px; }
        label { display: block; margin-top: 10px; }
        input { width: 300px; padding: 5px; }
        button { margin-top: 15px; padding: 10px 20px; }
        pre { background: #f4f4f4; padding: 10px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
<nav>
    <a href="index.html">ğŸ  Home</a>
    <a href="createCourse.html">â• Add Course</a>
    <a href="updateCourse.html">âœï¸ Update Course</a>
    <a href="getCourseById.html">ğŸ” Get Course By ID</a>
    <a href="deleteCourse.html">ğŸ—‘ï¸ Delete Course</a>
    <a href="getAllCourses.html">ğŸ“‹ View All Courses</a>
</nav>

<h1>Add a Course</h1>
<form id="courseForm">
    <label for="name">Course Name:</label>
    <input type="text" id="name" name="name" />

    <label for="hours">Course Hours:</label>
    <input type="number" id="hours" name="hours" step="0.5" />

    <label for="instructorId">Instructor ID:</label>
    <input type="number" id="instructorId" name="instructorId" />

    <label for="departmentId">Department ID (optional):</label>
    <input type="number" id="departmentId" name="departmentId" />

    <h3>Add Marks:</h3>
    <div id="marksContainer">
        <div class="mark-entry">
            <label>Student Name:</label>
            <input type="text" class="studentName" placeholder="Student Name" />
            <label>Score:</label>
            <input type="number" class="score" placeholder="Score" step="0.1" />
        </div>
    </div>
    <button type="button" onclick="addMarkField()">â• Add Another Mark</button>

    <button type="submit">Create Course</button>
    <button type="button" onclick="refreshForm()">ğŸ”„ Refresh</button>
</form>

<h3>Response:</h3>
<pre id="response"></pre>

<script>
    const form = document.getElementById("courseForm");
    const responseBox = document.getElementById("response");

    // Function to add more mark fields
    function addMarkField() {
      const marksContainer = document.getElementById("marksContainer");
      const newMarkEntry = document.createElement("div");
      newMarkEntry.className = "mark-entry";
      newMarkEntry.style.marginTop = "10px";
      newMarkEntry.innerHTML = `
        <label>Student Name:</label>
        <input type="text" class="studentName" placeholder="Student Name" />
        <label>Score:</label>
        <input type="number" class="score" placeholder="Score" step="0.1" />
        <button type="button" onclick="this.parentElement.remove()">âŒ Remove</button>
      `;
      marksContainer.appendChild(newMarkEntry);
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const hours = parseFloat(document.getElementById("hours").value);
      const instructorName = document.getElementById("instructorName").value;
      const departmentId = document.getElementById("departmentId").value
        ? parseInt(document.getElementById("departmentId").value)
        : null;

      // Collect all marks
      const markEntries = document.querySelectorAll(".mark-entry");
      const marks = [];
      markEntries.forEach(entry => {
        const studentName = entry.querySelector(".studentName").value;
        const score = parseFloat(entry.querySelector(".score").value);
        if (studentName && !isNaN(score)) {
          marks.push({
            studentName: studentName,
            score: score
          });
        }
      });

      const payload = {
        name: name,
        hours: hours,
        instructorName: instructorName,
        departmentId: departmentId,
        marks: marks
      };

      try {
        const res = await fetch("http://localhost:8080/courses/addFullCourse", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          const data = await res.json();
          responseBox.textContent = JSON.stringify(data, null, 2);
          responseBox.className = "success";
        } else {
          const errorData = await res.json().catch(() => null);
          if (errorData) {
            responseBox.textContent = JSON.stringify(errorData, null, 2);
          } else {
            responseBox.textContent = await res.text();
          }
          responseBox.className = "error";
        }

        responseBox.style.display = "block";
      } catch (err) {
        responseBox.textContent = "Error creating course: " + err;
        responseBox.className = "error";
        responseBox.style.display = "block";
      }
    });

    function refreshForm() {
      form.reset();
      responseBox.style.display = "none";
      // Reset to one mark entry
      const marksContainer = document.getElementById("marksContainer");
      marksContainer.innerHTML = `
        <div class="mark-entry">
            <label>Student Name:</label>
            <input type="text" class="studentName" placeholder="Student Name" />
            <label>Score:</label>
            <input type="number" class="score" placeholder="Score" step="0.1" />
        </div>
      `;
    }
</script>
</body>
</html>
